
<!DOCTYPE html>

<html lang="en" dir="ltr">
      <head>

          <!-- The core Firebase JS SDK is always required and must be listed first -->
      <script src="https://www.gstatic.com/firebasejs/8.6.4/firebase-app.js"></script>
      <script src="https://www.gstatic.com/firebasejs/8.6.4/firebase-auth.js"></script>
      <script src="https://www.gstatic.com/firebasejs/8.6.2/firebase-firestore.js"></script>
      <!-- Firebase Storage CDN -->
      <script src="https://www.gstatic.com/firebasejs/8.6.4/firebase-storage.js"></script>
      <!-- TODO: Add SDKs for Firebase products that you want to use
         https://firebase.google.com/docs/web/setup#available-libraries -->
      <script>
      // Your web app's Firebase configuration
      var firebaseConfig = {
        apiKey: "AIzaSyDjsKQlqNRWOWD6Qw6tklqtP03BtUW_lqw",
        authDomain: "groceryapp-b381a.firebaseapp.com",
        databaseURL: "https://groceryapp-b381a.firebaseio.com",
        projectId: "groceryapp-b381a",
        storageBucket: "groceryapp-b381a.appspot.com",
        messagingSenderId: "1092044916930",
        appId: "1:1092044916930:web:b3493c5ddfdef83633d35b",
        storageBucket: 'gs://groceryapp-b381a.appspot.com'

      };
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      var db = firebase.firestore();
      </script>
        <!-- The core Firebase JS SDK is always required and must be listed first -->

      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" charset="utf-8"/>
      <!-- Bootstrap RTL CSS -->
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.rtl.min.css" integrity="sha384-jHiSqEim4+W1UCvv8kTcMbtCZlRF8MxbgKdfpvncia8gdN1UImBnhTpKtufREzv7" crossorigin="anonymous">      <!-- Bootstrap css & javascript links -->
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
      <!-- Signup CSS Style File -->
      <link rel="stylesheet" href="signupstyles.css">
      <!-- Font Awesome for All Icons other than the quantity buttons-->
      <script src="https://kit.fontawesome.com/ab5937a0f1.js" crossorigin="anonymous"></script>
      <!-- Font Awesome fpr Quantity Buttons-->
      <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
      <!-- Google Fonts / Arabic -->
      <link rel="preconnect" href="https://fonts.gstatic.com">
      <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300&display=swap" rel="stylesheet">
      <!-- JQuery -->
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
      <!-- FIREBASE -->
      <style>
      .form-input>input[type=email]{
        color: black !important;
      }
      .form-input>input[type=password]{
          color: black !important;
        }
        </style>

  </head>

<body>
    <!-- ////////////////////////////////////// START NAVIGATION BAR ////////////////////////////////////////// -->
            <nav dir="rtl" class="navbar navbar-expand-lg navbar-light fixed-top border border-dark" style="padding: 5px; background-color: #fff;">
              <a id="logoFont" class="navbar-brand" href="../index.html" style="color: rgb(255, 92, 57); font-weight: bold; font-size: 2rem; margin-left: 35px;">كتشن باي</a>
                <div class="checkoutMobile myCart mr-5">
                  <a href="boughtMaterials.html">
                    <!-- <div class="checkoutBadge">0</div> -->
                    <!-- <i class="fas fa-2x fa-shopping-cart shopping-cart-icon"></i> -->
                  </a>
                </div>
            </nav>
        <!-- ///////////////////////////////// END NAVIGATION BAR //////////////////////////////////// -->
        <div class="container mt-5 mb-5">
            <div class="row d-flex align-items-center justify-content-center">
                <div class="col-md-6">
                    <div class="card px-5 py-5" style="margin-top: 50px;">
                      <span id="required1" style="font-size: 12px;">*Required</span>
                      <i id="required11" style="color: black" class="fas fa-check-circle d-none"></i>
                      <div class="form-input" style="text-align: left"> <i class="fa fa-envelope"></i> <input type="email" id="email" class="form-control" placeholder="Email address"> </div>
                      <span id="required2" style="font-size: 12px;">*Required <i>(minimum of six characters)</i></span>
                      <i id="required22" style="color: black" class="fas fa-check-circle d-none"></i>
                      <div class="form-input"> <i class="fa fa-lock"></i> <input type="password" id="password" class="form-control" placeholder="password"> </div> 
                      <button id="signIn" class="btn btn-primary mt-4 signup">دخول</button>
                        <!-- <div class="text-center mt-3"> <span>Or continue with these social profile</span> </div>
                        <div class="d-flex justify-content-center mt-4"> <span class="social"><i class="fa fa-google"></i></span> <span class="social"><i class="fa fa-facebook"></i></span> <span class="social"><i class="fa fa-twitter"></i></span> <span class="social"><i class="fa fa-linkedin"></i></span> </div> -->
                        <div style="text-align: center; " class="mt-4"> <span style="color: black">ليس لديك حساب؟</span> <a href="signup.html" class="text-decoration-none">سجل من هنا</a> </div>
                    </div>
                </div>
            </div>
        </div>
  </body>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
  <script src="signin.js" type="text/javascript"></script>
  <script type="text/javascript">
    firebase.auth().onAuthStateChanged((user) => {
    if (user) {

      let supplierEmail = document.getElementById("email").value;
          let isNewUser = false;

          // localStorage.setItem("supplierEmail", supplierEmail);
          // localStorage.setItem("supplierName", supplierName);
          localStorage.setItem("isNewUser", isNewUser);
      // START FETCHING USER DATABSE //
      var supplierProfiles = db.collection("suppliers").doc("Supplier Profiles");

        supplierProfiles.get().then((doc) => {
            if (doc.exists) {
              var data = doc.data()
              for (var key in data)
              {
                if (key == user.uid)
                {
                  console.log( key, data[key] );

                  let name = data[key]["supplierName"]
                  let supplierProfileImage = data[key]["supplierProfileImage"]
                  let email = data[key]["supplierEmail"]
                  let supplierID = data[key]["supplierID"]
                  let province = data[key]["supplierProvince"]
                  let city = data[key]["supplierCity"]
                  let clients = data[key]["clients"]
                  let products = data[key]["products"]
              
                  let stringifiedSupplierProducts = JSON.stringify(products);
                  let stringifiedSupplierClients = JSON.stringify(clients);
                  
                  let productsIsEmpty = "true";
                  let clientsIsEmpty = "true";

                    /* products */
                    let lengthOfProductsDictionary = 0;

                    if (products != null)
                    {
                      lengthOfProductsDictionary = Object.keys(products).length;
                      console.log("Number of products is: "+lengthOfProductsDictionary);
                    }
                    if (lengthOfProductsDictionary>0)
                    {
                      productsIsEmpty = "false";
                    }
                    else if (lengthOfProductsDictionary == 0)
                    {
                      productsIsEmpty = "true";
                    }

                    /* Clients */
                    let lengthOfClientsDictionary = 0;
                  
                    if ( clients != null)
                    {
                      lengthOfClientsDictionary = Object.keys(clients).length;
                      console.log("Number of clients is: "+lengthOfClientsDictionary);
                    }
                    if (lengthOfClientsDictionary>0)
                    {
                      clientsIsEmpty = "false";
                    }
                    else if (lengthOfClientsDictionary == 0)
                    {
                      clientsIsEmpty = "true";
                    }

                  localStorage.setItem("productsIsEmpty", productsIsEmpty);
                  localStorage.setItem("clientsIsEmpty", clientsIsEmpty);

                  localStorage.setItem("supplierProducts", stringifiedSupplierProducts)
                  localStorage.setItem("supplierClients", stringifiedSupplierClients)

                  localStorage.setItem("supplierName", name);
                  localStorage.setItem("supplierProfileImage", supplierProfileImage);
                  localStorage.setItem("supplierEmail", email);
                  localStorage.setItem("supplierID", supplierID);
                  localStorage.setItem("supplierProvince", province);
                  localStorage.setItem("supplierCity", city);
                  // localStorage.setItem("supplierProducts", products);
                  // localStorage.setItem("supplierClients", clients);

                  console.log(name+", "+email+", "+province+", "+city+", "+supplierID+", "+products+", "+clients);

                  // window.location.href = "user.html";
                  window.location.replace("user.html");
                }

                // console.log( key, data[key] );
              }
            } else {
                // doc.data() will be undefined in this case
                console.log("No such document!");
            }
        }).catch((error) => {
            console.log("Error getting document:", error);
        });
          // END FETCHING USER DATABSE //

          // User is signed in, see docs for a list of available properties
          // https://firebase.google.com/docs/reference/js/firebase.User         

      }
  });
  </script>
</html>
